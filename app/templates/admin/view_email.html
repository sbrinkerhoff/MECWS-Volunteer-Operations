{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold mb-0">Email Details</h2>
            <a href="{{ url_for('admin.list_emails') }}" class="btn btn-outline-secondary btn-sm">Back to List</a>
        </div>

        <div class="card card-glass border-0">
            <div class="card-body p-4">
                <div class="mb-4">
                    <h5 class="term-title">Subject</h5>
                    <p class="fs-5">{{ email.subject }}</p>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6 class="text-muted text-uppercase small ls-1">Recipient</h6>
                        <p class="fw-medium">
                            <a href="{{ url_for('admin.manage_team', q=email.recipient) }}"
                                class="text-decoration-none">
                                {{ email.recipient }} <i class="bi bi-box-arrow-up-right small ms-1"></i>
                            </a>
                        </p>
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-muted text-uppercase small ls-1">Status</h6>
                        {% if email.status == 'sent' %}
                        <span class="badge bg-success-subtle text-success border border-success-subtle">Sent</span>
                        {% elif email.status == 'failed' %}
                        <span class="badge bg-danger-subtle text-danger border border-danger-subtle">Failed</span>
                        {% else %}
                        <span
                            class="badge bg-secondary-subtle text-secondary border border-secondary-subtle">Pending</span>
                        {% endif %}
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-muted text-uppercase small ls-1">Queued At</h6>
                        <p>{{ email.created_at.strftime('%Y-%m-%d %I:%M %p') }}</p>
                    </div>
                </div>

                {% if email.sent_at %}
                <div class="mb-4">
                    <h6 class="text-muted text-uppercase small ls-1">Sent At</h6>
                    <p>{{ email.sent_at.strftime('%Y-%m-%d %I:%M %p') }}</p>
                </div>
                {% endif %}

                {% if email.error_message %}
                <div class="alert alert-danger mb-4">
                    <h6 class="alert-heading fw-bold"><i class="bi bi-exclamation-triangle me-2"></i>Error</h6>
                    <p class="mb-0">{{ email.error_message }}</p>
                </div>
                {% endif %}

                {% if email.sensitive %}
                <div class="alert alert-warning">
                    <i class="bi bi-shield-lock-fill me-2"></i>
                    This email is marked as sensitive. Its content is hidden for privacy.
                </div>
                {% else %}
                <ul class="nav nav-tabs mb-3" id="emailTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="text-tab" data-bs-toggle="tab" data-bs-target="#text"
                            type="button" role="tab">Text Body</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="html-tab" data-bs-toggle="tab" data-bs-target="#html" type="button"
                            role="tab">HTML Body</button>
                    </li>
                </ul>
                <div class="tab-content" id="emailTabsContent">
                    <div class="tab-pane fade show active" id="text" role="tabpanel">
                        <div class="bg-light p-3 rounded border font-monospace" style="white-space: pre-wrap;">{{
                            email.body_text or 'No text body' }}</div>
                    </div>
                    <div class="tab-pane fade" id="html" role="tabpanel">
                        <div class="bg-light p-3 rounded border">
                            {% if email.body_html %}
                            <iframe srcdoc="{{ email.body_html }}"
                                style="width: 100%; height: 400px; border: 0;"></iframe>
                            {% else %}
                            <p class="text-muted fst-italic">No HTML body</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>
{% endblock %}